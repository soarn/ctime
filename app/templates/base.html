<!DOCTYPE html>
<html lang="en" data-bs-theme="{{ current_theme }}">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{% block title %} ctime Scheduler {% endblock %}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <script src="https://unpkg.com/feather-icons@4.29.1/dist/feather.min.js" 
            crossorigin="anonymous"></script>
    <style>
      /* Set Icon Colors */
      .logo {
        color: var(--bs-primary);
        object-fit: cover;
        cursor: pointer;
      }
      i.feather {
        color: var(--bs-body-color);
      }
      /* Navbar Background and Text Color */
      .navbar {
        background-color: var(--bs-body-bg);
        color: var(--bs-body-color);
      }

      .navbar-title {
        font-size: 2rem;
        font-weight: bold;
        margin: 0;
        color: var(--bs-body-color);
      }

      /* Dark and Light Backgrounds for Main Sections */
      body {
        background-color: var(--bs-body-bg);
        color: var(--bs-body-color);
        transition: background-color 0.3s, color 0.3s;
      }

      /* Navbar Styling */
      .navbar-container {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0 1rem;
        flex-wrap: nowrap;
        background-color: var(--bs-body-bg)
      }

      .gravatar-img {
        width: 50px;
      }

      .navbar-brand img,
      .gravatar-img {
        border-radius: 50%;
        object-fit: cover;
        cursor: pointer;
        transition: transform 0.2s;
      }

      .gravatar-img:hover,
      .navbar-brand img:hover {
        transform: scale(1.1);
      }

      html {
        scroll-behavior: smooth;
        transition: background-color 0.3s, color 0.3s;
      }

      /* Dark Mode Toggle Styling */
      #themeToggle {
        display: flex;
        align-items: center;
        color: var(--bs-body-color);
        transition: color 0.3s;
      }

    </style>
</head>
<body>

  <!-- Header -->
   <nav class="navbar navbar-expand-lg">
    <div class="container-fluid navbar-container">
      <!-- Logo -->
       <a class="navbar-brand" href="{{ url_for('web.home') }}">
        <h1><i class="bi bi-calendar2-check logo"></i>
        <span class="navbar-title">ctime Scheduler</span>
      </h1>
      </a>

      <!-- Flash Messages -->
      <div id="flash-messages" class="position-fixed top-0 start-50 translate-middle-x mt-3">
        {% with messages = get_flashed_messages(with_categories=true) %}
          {% if messages %}
          <div class="container">
            {% for category, message in messages %}
            <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
              {{ message }}
              <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
            {% endfor %}
          </div>
          {% endif %}
        {% endwith %}
      </div>

      <!-- User Profile or Login/Register Buttons -->
       {% if current_user.is_authenticated %}
       <!-- Gravatar Dropdown -->
        <div class="dropdown">
          <img
            src="{{ get_gravatar_url(current_user.email) }}"
            alt="User Gravatar"
            class="gravatar-img dropdown-toggle"
            id="gravatarDropdown"
            data-bs-toggle="dropdown"
            aria-expanded="false"
          />
          <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="gravatarDropdown">
            <li><a class="dropdown-item" href="{{ url_for('web.profile') }}">Profile</a></li>
            {% if current_user.role == 'admin' %}
            <li><a class="dropdown-item" href="{{ url_for('admin.admin_dashboard') }}">Dashboard</a></li>
            {% else %}
            <li><a class="dropdown-item" href="{{ url_for('web.employee_dashboard') }}">Dashboard</a></li>
            {% endif %}
            <li><hr class="dropdown-divider" /></li>
            <li><a class="dropdown-item" href="{{ url_for('web.logout') }}">Logout</a></li>
            <li><hr class="dropdown-divider" /></li>
            <!-- Dark Mode Toggle -->
             <li class="dropdown-item">
              <button type="button" id="themeToggle" class="btn btn-link text-decoration-none d-flex align-items-center">
                <i id="themeIcon" data-feather="moon"></i>
                <span id="currentThemeName" class="ms-2">Dark Mode</span>
              </button>
            </li>
          </ul>
        </div>
        {% else %}
        <!-- Login/Register Buttons -->
         <div class="d-flex">
         <a class="btn btn-outline-light me-2" href="{{ url_for('web.login') }}">Login</a>
         <a class="btn btn-primary" href="{{ url_for('web.register') }}">Register</a>
        </div>
        {% endif %}
    </div>
  </nav>
  <!-- End Header -->

  <!-- Main Content Block -->

    <div class="container mt-4">{% block content %}{% endblock %}</div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"
            crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js" 
            crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/gsap@3.12.5/dist/gsap.min.js"
            crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"
            crossorigin="anonymous"></script>
 
    <script>

      //////////////
      // Dark Mode
      //////////////

      // Dark Mode Toggle
      const themeToggle = document.getElementById("themeToggle");
      const themeIcon = document.getElementById("themeIcon");

      // Function to get the cookie value
      function getCookie(name) {
        const value = `; ${document.cookie}`;
        const parts = value.split(`; ${name}=`);
        if (parts.length === 2) return parts.pop().split(';').shift();
      }

      // Set the initial theme based on cookie value
      const isDarkMode = getCookie("theme") === "dark";

      // Apply theme based on preference
      function applyTheme(darkMode) {
        document.documentElement.setAttribute("data-bs-theme", darkMode ? "dark" : "light");
        themeIcon.setAttribute("data-feather", darkMode ? "sun" : "moon");
        document.getElementById("currentThemeName").textContent = darkMode ? "Light Mode" : "Dark Mode";
        feather.replace();
      }

      applyTheme(isDarkMode);

      // Save theme to cookies and update theme when toggled
      themeToggle.addEventListener("click", function () {
        const darkMode = document.documentElement.getAttribute("data-bs-theme") !== "dark";
        document.cookie = `theme=${darkMode ? "dark" : "light"}; path=/; max-age=31536000`; // 1 year
        applyTheme(darkMode);
      })


      //////////////////
      // Flash Messages
      //////////////////

      // Auto dismiss flash messages after 3 seconds
      setTimeout(function () {
      let alerts = document.querySelectorAll(".alert");
      alerts.forEach(function (alert) {
          alert.classList.add("fade");
          alert.classList.remove("show");

          // Remove the element from the DOM after the transition
          setTimeout(function () {
          alert.remove();
          }, 1500);
      });
      }, 3000);
    </script>

    <script>feather.replace()</script>
</body>
</html>